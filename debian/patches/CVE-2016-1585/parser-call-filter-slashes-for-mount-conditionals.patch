From 054079b27172d7795a0959884b0a74a6741a3436 Mon Sep 17 00:00:00 2001
From: John Johansen <john.johansen@canonical.com>
Date: Tue, 1 Sep 2020 03:10:01 -0700
Subject: [PATCH 1/1] parser: call filter slashes for mount conditionals

The mnt_point and devices conditionals in mount rules are generally
paths and should have slashes filtered after variable expansion.

MR: https://gitlab.com/apparmor/apparmor/-/merge_requests/607
Signed-off-by: John Johansen <john.johansen@canonical.com>
(cherry picked from commit a1978fb1b2f9c97ae6ea7efb752e3d25ac261830)
Signed-off-by: John Johansen <john.johansen@canonical.com>
---
 parser/mount.cc | 2 ++
 1 file changed, 2 insertions(+)

--- apparmor-2.13.3.orig/parser/mount.cc
+++ apparmor-2.13.3/parser/mount.cc
@@ -492,9 +492,11 @@ int mnt_rule::expand_variables(void)
 	error = expand_entry_variables(&mnt_point);
 	if (error)
 		return error;
+	filter_slashes(mnt_point);
 	error = expand_entry_variables(&device);
 	if (error)
 		return error;
+	filter_slashes(device);
 	error = expand_entry_variables(&trans);
 	if (error)
 		return error;
